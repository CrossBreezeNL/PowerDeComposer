# Build pipeline for PowerDeComposer.
# This will build PowerDeComposer and run the test suite defined in the PowerDeComposerTest folder.

trigger:
- master
- feature/*

pool:
  vmImage: windows-latest # PowerDeComposer will run primary on Windows, so we use this in the build.

steps:
- task: Maven@3
  inputs:
    mavenPomFile: 'PowerDeComposer/pom.xml'
    jdkVersionOption: '1.11'
    goals: 'install'
- task: Maven@3
  inputs:
    mavenPomFile: 'PowerDeComposerTest/pom.xml'
    jdkVersionOption: '1.11'
    publishJUnitResults: true
    testResultsFiles: '**/surefire-reports/TEST-*.xml'
    goals: 'test'
- task: PublishCucumberReport@1
  displayName: 'Publish Cucumber Report'
  # Run this task also if the previous task has failed (so a test failed).
  condition: succeededOrFailed()
  inputs:
    jsonDir: ./PowerDeComposerTest/target/cucumber-reports
    outputPath: ./PowerDeComposerTest/target/cucumber-reports
    name: 'Unit Tests'
    title: PowerDeComposer